import locale
import gettext
import os

# Translation dictionary
# format: [key][language_code] = translation
# Key is usually the English string
TRANSLATIONS = {
    "AGROS Mission Control & Live Scan Station": {
        "hi": "рдПрдЧреНрд░реЛрд╕ рдорд┐рд╢рди рдХрдВрдЯреНрд░реЛрд▓ рдФрд░ рд▓рд╛рдЗрд╡ рд╕реНрдХреИрди рд╕реНрдЯреЗрд╢рди",
        "ta": "роЕроХрпНро░рпЛро╕рпН рооро┐ро╖ройрпН роХройрпНроЯрпНро░рпЛро▓рпН & ро▓рпИро╡рпН ро╕рпНроХрпЗройрпН роиро┐ро▓рпИропроорпН",
        "te": "р░Ер░Чр▒Нр░░р▒Лр░╕р▒Н р░ор░┐р░╖р░ир▒Н р░Хр░Вр░Яр▒Нр░░р▒Лр░▓р▒Н & р░▓р▒Ир░╡р▒Н р░╕р▒Нр░Хр░╛р░ир▒Н р░╕р▒Нр░Яр▒Зр░╖р░ир▒Н",
        "ml": "р┤Ер┤Чр╡Нр┤░р╡Лр┤╕р╡Н р┤ор┤┐р┤╖р╡╗ р┤Хр╡║р┤Яр╡Нр┤░р╡Лр╡╛ & р┤▓р╡Ир┤╡р╡Н р┤╕р╡Нр┤Хр┤╛р╡╗ р┤╕р╡Нр┤▒р╡Нр┤▒р╡Зр┤╖р╡╗"
    },
    "ЁЯФМ CONNECT": { "hi": "ЁЯФМ рдХрдиреЗрдХреНрдЯ", "ta": "ЁЯФМ роЗрогрпИроХрпНроХро╡рпБроорпН", "te": "ЁЯФМ р░Хр░ир▒Жр░Хр▒Нр░Яр▒Н р░Ър▒Зр░пр░Вр░бр░┐", "ml": "ЁЯФМ р┤мр┤ир╡Нр┤зр┤┐р┤кр╡Нр┤кр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х" },
    "DISCONNECTED": { "hi": "рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯреЗрдб", "ta": "родрпБрогрпНроЯро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ", "te": "р░бр░┐р░╕р▒Нр░Хр░ир▒Жр░Хр▒Нр░Яр▒Н р░Ър▒Зр░пр░мр░бр░┐р░Вр░жр░┐", "ml": "р┤мр┤ир╡Нр┤зр┤В р┤╡р┤┐р┤Ър╡Нр┤Ыр╡Зр┤жр┤┐р┤Хр╡Нр┤Хр┤кр╡Нр┤кр╡Жр┤Яр╡Нр┤Яр╡Б" },
    "CONNECTED": { "hi": "рдХрдиреЗрдХреНрдЯреЗрдб", "ta": "роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯродрпБ", "te": "р░Хр░ир▒Жр░Хр▒Нр░Яр▒Н р░Ър▒Зр░пр░мр░бр░┐р░Вр░жр░┐", "ml": "р┤мр┤ир╡Нр┤зр┤┐р┤кр╡Нр┤кр┤┐р┤Ър╡Нр┤Ър╡Б" },
    "CONNECTING...": { "hi": "рдХрдиреЗрдХреНрдЯрд┐рдВрдЧ...", "ta": "роЗрогрпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ...", "te": "р░Хр░ир▒Жр░Хр▒Нр░Яр▒Н р░Ер░╡р▒Бр░др▒Лр░Вр░жр░┐...", "ml": "р┤мр┤ир╡Нр┤зр┤┐р┤кр╡Нр┤кр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б..." },
    "MAVLink Status:": { "hi": "MAVLink рд╕реНрдерд┐рддрд┐:", "ta": "рооро╛ро╡рпНро▓ро┐роЩрпНроХрпН роиро┐ро▓рпИ:", "te": "MAVLink р░╕р▒Нр░ер░┐р░др░┐:", "ml": "MAVLink р┤ир┤┐р┤▓:" },
    "GEOFENCE BREACH!": { "hi": "рдЬрд┐рдпреЛрдлреЗрдВрд╕ рдЙрд▓реНрд▓рдВрдШрди!", "ta": "роЬро┐ропрпЛроГрокрпЖройрпНро╕рпН роорпАро▒ро▓рпН!", "te": "р░Ьр░┐р░пр▒Лр░лр▒Жр░ир▒Нр░╕р▒Н р░Йр░▓р▒Нр░▓р░Вр░Шр░и!", "ml": "р┤Ьр┤┐р┤пр╡Лр┤лр╡Жр╡╗р┤╕р╡Н р┤▓р┤Вр┤Шр┤ир┤В!" },
    "Drone is outside the geofence!": { "hi": "рдбреНрд░реЛрди рдЬрд┐рдпреЛрдлреЗрдВрд╕ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИ!", "ta": "роЯрпНро░рпЛройрпН роЬро┐ропрпЛроГрокрпЖройрпНро╕рпБроХрпНроХрпБ ро╡рпЖро│ро┐ропрпЗ роЙро│рпНро│родрпБ!", "te": "р░бр▒Нр░░р▒Лр░ир▒Н р░Ьр░┐р░пр▒Лр░лр▒Жр░ир▒Нр░╕р▒Н р░╡р▒Жр░▓р▒Бр░кр░▓ р░Йр░Вр░жр░┐!", "ml": "р┤бр╡Нр┤░р╡Лр╡║ р┤Ьр┤┐р┤пр╡Лр┤лр╡Жр╡╗р┤╕р┤┐р┤ир╡Н р┤кр╡Бр┤▒р┤др╡Нр┤др┤╛р┤гр╡Н!" },
    "RETURN TO LAUNCH (RTL)": { "hi": "рд▓реЙрдиреНрдЪ рдкрд░ рд╡рд╛рдкрд╕реА (RTL)", "ta": "родрпКроЯроЩрпНроХрокрпНрокроЯрпНроЯ роЗроЯродрпНродро┐ро▒рпНроХрпБродрпН родро┐ро░рпБроорпНрокрпБ (RTL)", "te": "р░▓р░╛р░Вр░Ър▒Н р░╡р░жр▒Нр░жр░Хр▒Б р░др░┐р░░р░┐р░Чр░┐ р░╡р▒Жр░│р▒Нр░│р▒Б (RTL)", "ml": "р┤▓р╡Лр┤Юр╡Нр┤Ър┤┐р┤▓р╡Зр┤Хр╡Нр┤Хр╡Н р┤ор┤Яр┤Щр╡Нр┤Щр╡Бр┤Х (RTL)" },
    "LAND IMMEDIATELY": { "hi": "рддреБрд░рдВрдд рдЙрддрд░реЗрдВ", "ta": "роЙроЯройроЯро┐ропро╛роХродрпН родро░рпИропро┐ро▒роЩрпНроХрпБроЩрпНроХро│рпН", "te": "р░╡р▒Жр░Вр░Яр░ир▒З р░▓р▒Нр░пр░╛р░Вр░бр▒Н р░Ер░╡р▒Нр░╡р░Вр░бр░┐", "ml": "р┤Йр┤Яр╡╗ р┤▓р┤╛р╡╗р┤бр╡Н р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х" },
    "CONTINUE MISSION": { "hi": "рдорд┐рд╢рди рдЬрд╛рд░реА рд░рдЦреЗрдВ", "ta": "рокрогро┐ропрпИродрпН родрпКроЯро░ро╡рпБроорпН", "te": "р░ор░┐р░╖р░ир▒Н р░Хр▒Кр░ир░╕р░╛р░Чр░┐р░Вр░Ър░Вр░бр░┐", "ml": "р┤жр╡Чр┤др╡Нр┤пр┤В р┤др╡Бр┤Яр┤░р╡Бр┤Х" },
    "Settings": { "hi": "рд╕реЗрдЯрд┐рдВрдЧреНрд╕", "ta": "роЕроорпИрокрпНрокрпБроХро│рпН", "te": "р░╕р▒Жр░Яр▒Нр░Яр░┐р░Вр░Чр▒Бр░▓р▒Б", "ml": "р┤Хр╡Нр┤░р┤ор╡Ар┤Хр┤░р┤гр┤Щр╡Нр┤Щр╡╛" },
    "Communication Configuration": { "hi": "рд╕рдВрдЪрд╛рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди", "ta": "родрпКроЯро░рпНрокрпБ роЙро│рпНро│роорпИро╡рпБ", "te": "р░Хр░ор▒Нр░пр▒Вр░ир░┐р░Хр▒Зр░╖р░ир▒Н р░Хр░╛р░ир▒Нр░лр░┐р░Чр░░р▒Зр░╖р░ир▒Н", "ml": "р┤Хр┤ор╡Нр┤ор╡Нр┤пр╡Вр┤гр┤┐р┤Хр╡Нр┤Хр╡Зр┤╖р╡╗ р┤Хр╡Лр╡║р┤лр┤┐р┤Чр┤▒р╡Зр┤╖р╡╗" },
    "MAVLink Connection String:": { "hi": "MAVLink рдХрдиреЗрдХреНрд╢рди рд╕реНрдЯреНрд░рд┐рдВрдЧ:", "ta": "рооро╛ро╡рпНро▓ро┐роЩрпНроХрпН роЗрогрпИрокрпНрокрпБ роЪро░роорпН:", "te": "MAVLink р░Хр░ир▒Жр░Хр▒Нр░╖р░ир▒Н р░╕р▒Нр░Яр▒Нр░░р░┐р░Вр░Чр▒Н:", "ml": "MAVLink р┤Хр┤гр┤Хр╡Нр┤╖р╡╗ р┤╕р╡Нр┤Яр╡Нр┤░р┤┐р┤Вр┤Чр╡Н:" },
    "Mission Planner Integration (Universal)": { "hi": "рдорд┐рд╢рди рдкреНрд▓рд╛рдирд░ рдПрдХреАрдХрд░рдг (рдпреВрдирд┐рд╡рд░реНрд╕рд▓)", "ta": "рооро┐ро╖ройрпН рокро┐ро│ро╛ройро░рпН роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ (ропрпБройро┐ро╡ро░рпНроЪро▓рпН)", "te": "р░ор░┐р░╖р░ир▒Н р░кр▒Нр░▓р░╛р░ир░░р▒Н р░Зр░Вр░Яр░┐р░Чр▒Нр░░р▒Зр░╖р░ир▒Н (р░пр▒Вр░ир░┐р░╡р░░р▒Нр░╕р░▓р▒Н)", "ml": "р┤ор┤┐р┤╖р╡╗ р┤кр╡Нр┤▓р┤╛р┤ир╡╝ р┤Зр┤ир╡Нр┤▒р┤Чр╡Нр┤░р╡Зр┤╖р╡╗ (р┤пр╡Вр┤гр┤┐р┤╡р╡Зр┤┤р╡Нр┤╕р╡╜)" },
    "Mission Planner Executable:": { "hi": "рдорд┐рд╢рди рдкреНрд▓рд╛рдирд░ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп:", "ta": "рооро┐ро╖ройрпН рокро┐ро│ро╛ройро░рпН роЗропроЩрпНроХроХрпНроХрпВроЯро┐ропродрпБ:", "te": "р░ор░┐р░╖р░ир▒Н р░кр▒Нр░▓р░╛р░ир░░р▒Н р░Ор░Хр▒Нр░Ьр░┐р░Хр▒Нр░пр▒Вр░Яр░мр▒Бр░▓р▒Н:", "ml": "р┤ор┤┐р┤╖р╡╗ р┤кр╡Нр┤▓р┤╛р┤ир╡╝ р┤Ор┤Хр╡Нр┤╕р┤┐р┤Хр╡Нр┤пр╡Вр┤Яр╡Нр┤Яр┤мр┤┐р╡╛:" },
    "Language Settings": { "hi": "рднрд╛рд╖рд╛ рд╕реЗрдЯрд┐рдВрдЧреНрд╕", "ta": "роорпКро┤ро┐ роЕроорпИрокрпНрокрпБроХро│рпН", "te": "р░нр░╛р░╖р░╛ р░╕р▒Жр░Яр▒Нр░Яр░┐р░Вр░Чр▒Бр░▓р▒Б", "ml": "р┤нр┤╛р┤╖р┤╛ р┤Хр╡Нр┤░р┤ор╡Ар┤Хр┤░р┤гр┤Щр╡Нр┤Щр╡╛" },
    "Select UI Language:": { "hi": "UI рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ:", "ta": "UI роорпКро┤ро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН:", "te": "UI р░нр░╛р░╖р░ир▒Б р░Ор░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐:", "ml": "UI р┤нр┤╛р┤╖ р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х:" },
    "System Language": { "hi": "рд╕рд┐рд╕реНрдЯрдо рднрд╛рд╖рд╛", "ta": "роорпБро▒рпИроорпИ роорпКро┤ро┐", "te": "р░╕р░┐р░╕р▒Нр░Яр░ор▒Н р░нр░╛р░╖", "ml": "р┤╕р┤┐р┤╕р╡Нр┤▒р╡Нр┤▒р┤В р┤нр┤╛р┤╖" },
    "Apply Settings": { "hi": "рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд▓рд╛рдЧреВ рдХрд░реЗрдВ", "ta": "роЕроорпИрокрпНрокрпБроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБ", "te": "р░╕р▒Жр░Яр▒Нр░Яр░┐р░Вр░Чр▒Бр░▓р░ир▒Б р░╡р░░р▒Нр░др░┐р░Вр░кр░Ьр▒Зр░пр░Вр░бр░┐", "ml": "р┤Хр╡Нр┤░р┤ор╡Ар┤Хр┤░р┤гр┤Щр╡Нр┤Щр╡╛ р┤кр╡Нр┤░р┤пр╡Лр┤Чр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х" },
    "CLEAR ALL": { "hi": "рд╕рднреА рд╕рд╛рдлрд╝ рдХрд░реЗрдВ", "ta": "роЕройрпИродрпНродрпИропрпБроорпН роЕро┤ро┐роХрпНроХро╡рпБроорпН", "te": "р░Ер░ир▒Нр░ир▒А р░Хр▒Нр░▓р░┐р░пр░░р▒Н р░Ър▒Зр░пр░Вр░бр░┐", "ml": "р┤Ор┤▓р╡Нр┤▓р┤╛р┤В р┤ор┤╛р┤пр╡НтАМр┤Хр╡Нр┤Хр╡Бр┤Х" },
    "UPLOAD KML": { "hi": "KML рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ", "ta": "KML роРрокрпН рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН", "te": "KML р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░пр░Вр░бр░┐", "ml": "KML р┤Ер┤кр╡НтАМр┤▓р╡Лр┤бр╡Н р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х" },
    "UPLOAD FROM FILE": { "hi": "рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ", "ta": "роХрпЛрокрпНрокро┐ро▓ро┐ро░рпБроирпНродрпБ рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН", "te": "р░лр▒Ир░▓р▒Н р░ир▒Бр░Вр░бр░┐ р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░пр░Вр░бр░┐", "ml": "р┤лр┤пр┤▓р┤┐р╡╜ р┤ир┤┐р┤ир╡Нр┤ир╡Н р┤Ер┤кр╡НтАМр┤▓р╡Лр░бр▒Н р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х" },
    "GENERATE WAYPOINTS": { "hi": "рд╡реЗрдкреЙрдЗрдВрдЯ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ", "ta": "ро╡рпЗ рокро╛ропро┐рогрпНроЯрпНроЯрпБроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН", "te": "р░╡р▒З р░кр░╛р░пр░┐р░Вр░Яр▒Нр░▓р░ир▒Б р░╕р▒Гр░╖р▒Нр░Яр░┐р░Вр░Ър░Вр░бр░┐", "ml": "р┤╡р╡З р┤кр╡Лр┤пр┤┐р┤ир╡Нр┤▒р╡Бр┤Хр╡╛ р┤╕р╡Гр┤╖р╡Нр┤Яр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х" },
    "Targets Map View": { "hi": "рд▓рдХреНрд╖реНрдп рдорд╛рдирдЪрд┐рддреНрд░ рджреГрд╢реНрдп", "ta": "роЗро▓роХрпНроХрпБроХро│рпН ро╡ро░рпИрокроЯ рокро╛ро░рпНро╡рпИ", "te": "р░▓р░Хр▒Нр░╖р▒Нр░пр░╛р░▓ р░ор▒Нр░пр░╛р░кр▒Н р░╡р▒Ар░Хр▒Нр░╖р░г", "ml": "р┤▓р┤Хр╡Нр┤╖р╡Нр┤пр┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤ор┤╛р┤кр╡Нр┤кр╡Н р┤Хр┤╛р┤┤р╡Нр┤Ъ" },
    "Daily Logs & History": { "hi": "рджреИрдирд┐рдХ рд▓реЙрдЧ рдФрд░ рдЗрддрд┐рд╣рд╛рд╕", "ta": "родро┐ройроЪро░ро┐ рокродро┐ро╡рпБроХро│рпН рооро▒рпНро▒рпБроорпН ро╡ро░ро▓ро╛ро▒рпБ", "te": "р░░р▒Лр░Ьр▒Бр░╡р░╛р░░р▒А р░▓р░╛р░Чр▒Нр░▓р▒Б & р░Ър░░р░┐р░др▒Нр░░", "ml": "р┤кр╡Нр┤░р┤др┤┐р┤жр┤┐р┤и р┤▓р╡Лр┤Чр╡Бр┤Хр┤│р╡Бр┤В р┤Ър┤░р┤┐р┤др╡Нр┤░р┤╡р╡Бр┤В" },
    "Spraying Parameters": { "hi": "рдЫрд┐рдбрд╝рдХрд╛рд╡ рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░", "ta": "родрпЖро│ро┐роХрпНроХрпБроорпН роЕро│ро╡рпБро░рпБроХрпНроХро│рпН", "te": "р░╕р▒Нр░кр▒Нр░░р▒Зр░пр░┐р░Вр░Чр▒Н р░кр░╛р░░р░╛р░ор░┐р░др▒Бр░▓р▒Б", "ml": "р┤др┤│р┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤и р┤кр┤╛р┤░р┤╛р┤ор╡Ар┤▒р╡Нр┤▒р┤▒р╡Бр┤Хр╡╛" },
    "Spraying Altitude (m):": { "hi": "рдЫрд┐рдбрд╝рдХрд╛рд╡ рдХреА рдКрдВрдЪрд╛рдИ (m):", "ta": "родрпЖро│ро┐роХрпНроХрпБроорпН роЙропро░роорпН (m):", "te": "р░╕р▒Нр░кр▒Нр░░р▒Зр░пр░┐р░Вр░Чр▒Н р░Ор░др▒Нр░др▒Б (m):", "ml": "р┤др┤│р┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤и р┤Йр┤пр┤░р┤В (m):" },
    "Loiter Time (s):": { "hi": "рд▓реЛрдЗрдЯрд░ рд╕рдордп (s):", "ta": "ро▓рпЛропро┐роЯрпНроЯро░рпН роирпЗро░роорпН (s):", "te": "р░▓р▒Лр░пр░┐р░Яр░░р▒Н р░╕р░ор░пр░В (s):", "ml": "р┤▓р╡Лр┤пр┤┐р┤▒р╡Нр┤▒р╡╝ р┤╕р┤ор┤пр┤В (s):" }
}

def get_system_lang():
    """Detects system language code (e.g., 'en', 'hi', 'ta')."""
    try:
        lang, _ = locale.getdefaultlocale()
        if lang:
            return lang.split('_')[0].lower()
    except:
        pass
    return "en"

CURRENT_LANG = "en"

def set_language(lang_code):
    global CURRENT_LANG
    if lang_code == "System":
        CURRENT_LANG = get_system_lang()
    else:
        # Extract language code from format like "English (en)" or "рд╣рд┐рдиреНрджреА (hi)"
        if "(" in lang_code and ")" in lang_code:
            # Extract code between parentheses
            CURRENT_LANG = lang_code.split("(")[1].split(")")[0].strip()
        else:
            CURRENT_LANG = lang_code

def _(text):
    """Translation function."""
    if text in TRANSLATIONS and CURRENT_LANG in TRANSLATIONS[text]:
        return TRANSLATIONS[text][CURRENT_LANG]
    return text

# Initial detection
CURRENT_LANG = get_system_lang()
